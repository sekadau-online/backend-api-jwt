# Example .env file for development and testing
# DO NOT store real secrets here. Replace values with your local/test credentials.

# Server binding
APP_HOST=127.0.0.1
APP_PORT=3002

# Database (MySQL) — replace user/password/host/port/dbname as appropriate
# Example: mysql://root:password@127.0.0.1:3306/db_backend_api_jwt
DB_HOST=127.0.0.1
DB_USER=root
DB_PASS=your_password_here
DATABASE_URL=mysql://${DB_USER}:${DB_PASS}@${DB_HOST}:3306/db_backend_api_jwt

# JWT secret used for signing tokens (keep long & random in production)
JWT_SECRET=change_me_for_tests_or_dev

# CORS configuration
# ENABLE_CORS=true will enable permissive CORS (allow any origin).
# You can alternatively set CORS_ALLOWED_ORIGINS to a comma-separated list of origins or to a single "*" value to allow any origin.
# Examples:
#   CORS_ALLOWED_ORIGINS=*            # permissive (allow any origin)
#   CORS_ALLOWED_ORIGINS=https://app.example.com,https://admin.example.com
ENABLE_CORS=false
CORS_ALLOWED_ORIGINS=*

# CI/test convenience values (used only by your CI workflow if you set them in repository secrets)
# NOTE: DO NOT commit real secrets here - add them to GitHub Secrets instead.
MYSQL_ROOT_PASSWORD=rusttest

# Optional: override DB used by integration tests locally
# Example: mysql://root:password@127.0.0.1:3306/db_backend_api_jwt_test
DATABASE_URL_TEST=mysql://${DB_USER}:${DB_PASS}@${DB_HOST}:3306/db_backend_api_jwt_test

# Connection pool configuration (tune for your DB instance)
# - DB_POOL_SIZE: maximum connections in the pool (default 20)
# - DB_POOL_MIN: minimum/pre-warmed connections (default min(DB_POOL_SIZE, 5))
# - DB_CONNECT_TIMEOUT_SECS: TCP connect timeout when establishing a new connection (default 5)
# - DB_ACQUIRE_TIMEOUT_SECS: time to wait acquiring a connection from the pool (default 10)
DB_POOL_SIZE=20
DB_POOL_MIN=5
DB_CONNECT_TIMEOUT_SECS=5
DB_ACQUIRE_TIMEOUT_SECS=10

# Rate limiting (per IP) — token-bucket config
# - RATE_LIMIT_RPS: refill rate in tokens per second (default 100)
# - RATE_LIMIT_BURST: maximum tokens the bucket can hold (default: RATE_LIMIT_RPS * 2)
# - RATE_LIMIT_REQUEST_COST: float cost per request (default 1.0). Use <1.0 to allow more effective capacity per key (useful when many clients share an IP behind NAT/edge)
# - RATE_LIMIT_ACTION: behavior when bucket is empty: "drop" (close/204), "throttle" (429), etc. (default: drop)
# - RATE_LIMIT_DEBUG: when true exposes /debug/rate_limiter for local inspection (protect this endpoint with RATE_LIMIT_DEBUG_TOKEN)
RATE_LIMIT_REQUEST_COST=0.2
RATE_LIMIT_ACTION=drop
RATE_LIMIT_RPS=100
RATE_LIMIT_BURST=200
RATE_LIMIT_DEBUG=false
RATE_LIMIT_DEBUG_TOKEN=<your_debug_token_here>

# Debug: TRUSTED_PROXIES (comma-separated CIDR list)
# - Used to detect client IP from proxy headers (CF-Connecting-IP, X-Forwarded-For, X-Real-IP)
# - Add IPv6 ranges if you expect IPv6 traffic (example IPv6 values: 2400:cb00::/32, 2606:4700::/32)
TRUSTED_PROXIES=

# Comma-separated CIDR list of trusted proxies (e.g. Cloudflare IP ranges)
# Example to trust all local proxies during tests: 0.0.0.0/0
TRUSTED_PROXIES=

# Example usage
# 1. Copy this file to .env and edit values:
#    cp .env.example .env
# 2. Create DB and run migrations if needed:
#    mysql -u ${DB_USER} -p -e "CREATE DATABASE IF NOT EXISTS db_backend_api_jwt;"
# 3. Run the server:
#    cargo run

# Notes:
# - Keep secrets (DB passwords, JWT_SECRET) out of git and use secret managers for production.
# - Use .env.test or CI secrets for running integration tests in CI.
